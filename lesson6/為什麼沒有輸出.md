# 🔍 為什麼 Jupyter Notebook 執行後沒有輸出？

## ✅ 代碼測試結果

已驗證：**Notebook 的所有 cells 都能正常執行並產生輸出！**

測試腳本 `test_notebook_cells.py` 證明了代碼本身沒問題。

---

## 🎯 可能的原因和解決方法

### **原因 1：Cell 沒有真正執行**

#### **症狀：**
- 點擊了 Run 按鈕，但沒有看到輸出
- Cell 左側沒有出現執行計數 `[數字]`
- 或顯示 `[*]`（表示正在執行）但一直不結束

#### **檢查方法：**
看 Cell 左側：
```
[ ]    ← 從未執行
[1]    ← 已執行（數字是執行順序）
[*]    ← 正在執行中
```

#### **解決方法：**
1. **確認 Kernel 正在運行**
   - 看右上角是否顯示 "Python 3 | Idle" 或 "Connected"
   - 如果顯示 "No Kernel"，需要重新連接

2. **重啟 Kernel**
   ```
   Kernel → Restart Kernel → Restart
   ```

3. **重新執行 Cell**
   - 點擊 Cell，按 `Shift + Enter` 執行

---

### **原因 2：Cell 執行順序錯誤**

#### **症狀：**
- Cell 6/7/8 顯示錯誤：`❌ 錯誤：client 不存在，請先執行 Cell 4 建立連線`

#### **原因：**
沒有按照 **Cell 1 → 2 → 3 → 4** 的順序執行

#### **解決方法：**
1. **重啟 Kernel**
   ```
   Kernel → Restart Kernel → Restart
   ```

2. **按順序執行**
   ```
   Cell 1 (匯入套件) → 執行 ✅
   Cell 2 (設定配置) → 執行 ✅
   Cell 3 (定義回調) → 執行 ✅
   Cell 4 (建立連線) → 執行 ✅
   ```

3. **等待看到**
   ```
   ✅ MQTT 客戶端已就緒
   ```

4. **然後再執行 Cell 6/7/8**

---

### **原因 3：Kernel 正在執行其他 Cell**

#### **症狀：**
- 點擊執行後，Cell 左側顯示 `[*]`
- 長時間沒有輸出

#### **原因：**
Kernel 正在執行另一個 Cell（例如 Cell 7 的批次發布需要 5 秒）

#### **解決方法：**
**等待當前 Cell 執行完成**，或按 `⏹️` (停止) 按鈕中斷執行

---

### **原因 4：Cell 4 被重複執行**

#### **症狀：**
看到這個警告：
```
⚠️ 警告：client 已存在！請重啟 Kernel 後再執行
   操作：Kernel → Restart Kernel → Restart
```

#### **原因：**
Cell 4（建立連線）被執行了多次

#### **解決方法：**
1. **立即重啟 Kernel**
   ```
   Kernel → Restart Kernel → Restart
   ```

2. **重新按順序執行**
   ```
   Cell 1 → 2 → 3 → 4（只執行一次！）
   ```

---

### **原因 5：輸出區域被隱藏**

#### **症狀：**
- Cell 執行了（左側有數字 `[1]`）
- 但看不到輸出

#### **檢查方法：**
1. **檢查 Cell 下方是否有輸出區域**
2. **查看是否被摺疊**（點擊 Cell 左側的展開/摺疊按鈕）

#### **解決方法：**
點擊 Cell，選擇：
```
Cell → Current Outputs → Show
```

---

### **原因 6：瀏覽器問題**

#### **症狀：**
- 其他都正常，但就是看不到輸出

#### **解決方法：**
1. **刷新頁面**（F5）
2. **清除瀏覽器快取**
3. **換一個瀏覽器**試試

---

### **原因 7：Jupyter 版本問題**

#### **檢查版本：**
在終端機執行：
```bash
uv run jupyter --version
```

#### **解決方法：**
如果版本太舊，更新：
```bash
uv pip install --upgrade jupyter notebook
```

---

## 🧪 快速診斷步驟

### **步驟 1：驗證代碼能執行**
```bash
cd /home/pi/Documents/GiHub/20251026-raspberry_pi_pico
uv run python lesson6/test_notebook_cells.py
```

如果這個能正常輸出，代表代碼沒問題，問題在 Jupyter。

### **步驟 2：檢查 Kernel 狀態**
在 Jupyter Notebook 中，看右上角：
- ✅ **"Python 3 | Idle"** - 正常
- ❌ **"No Kernel"** - 需要重新連接
- ⏳ **"Python 3 | Busy"** - 正在執行，等待

### **步驟 3：測試簡單 Cell**
新建一個 Cell，輸入：
```python
print("Hello, World!")
```

按 `Shift + Enter` 執行。

- ✅ **看到輸出** → Jupyter 正常，回去檢查原 Notebook
- ❌ **沒有輸出** → Jupyter 有問題，需要重啟

### **步驟 4：逐個執行 Cell**
從 Cell 1 開始，依序執行，觀察每個 Cell 的輸出：

```
Cell 1: 應該看到 "✅ 套件匯入成功！"
Cell 2: 應該看到 "📡 MQTT 連線設定" 和配置資訊
Cell 3: 應該看到 "✅ 回調函數定義完成"
Cell 4: 應該看到 "✅ MQTT 客戶端已就緒"
Cell 5: 應該看到 JSON 格式的測試數據
Cell 6: 應該看到 "✅ 發布成功！" 和溫濕度資訊
```

如果某個 Cell 沒有輸出，**停在那個 Cell 檢查**。

---

## ✅ 標準操作流程

### **每次使用 Notebook 前：**

1. **重啟 Kernel**
   ```
   Kernel → Restart Kernel → Restart
   ```

2. **清除所有輸出**（可選）
   ```
   Kernel → Restart Kernel and Clear All Outputs
   ```

3. **按順序執行 Cell 1-4**
   ```
   選擇 Cell 1，然後按 Shift + Enter
   自動跳到下一個 Cell，繼續按 Shift + Enter
   執行到 Cell 4
   ```

4. **確認看到：**
   ```
   ✅ MQTT 客戶端已就緒
   ```

5. **執行測試 Cells（6/7/8）**

6. **完成後清理**
   ```
   執行 Cell 9
   ```

---

## 🔧 常用快捷鍵

```
Shift + Enter    執行當前 Cell 並跳到下一個
Ctrl + Enter     執行當前 Cell 但不跳轉
Alt + Enter      執行當前 Cell 並在下方插入新 Cell

Esc              進入命令模式
Enter            進入編輯模式

A                在上方插入 Cell（命令模式）
B                在下方插入 Cell（命令模式）
DD               刪除 Cell（命令模式，按兩次 D）

00               重啟 Kernel（命令模式，按兩次 0）
```

---

## 🚀 最可靠的測試方法

如果 Jupyter Notebook 一直有問題，**直接使用命令列腳本**：

### **方法 1：使用測試腳本**
```bash
cd /home/pi/Documents/GiHub/20251026-raspberry_pi_pico
uv run python lesson6/test_notebook_cells.py
```

### **方法 2：使用獨立的 MQTT 腳本**
```bash
# 終端機 1 - 訂閱者
uv run python lesson6/mqtt_subscribe_test.py

# 終端機 2 - 發布者
uv run python lesson6/mqtt_test_simple.py
```

### **方法 3：一鍵測試**
```bash
./lesson6/test_mqtt.sh
```

這些方法**100% 可靠**，不會有任何輸出問題！

---

## 📊 檢查清單

使用這個清單確認：

- [ ] Jupyter Kernel 正在運行（右上角顯示 "Idle"）
- [ ] 已重啟 Kernel
- [ ] 按順序執行 Cell 1 → 2 → 3 → 4
- [ ] Cell 4 只執行了一次
- [ ] 看到 "✅ MQTT 客戶端已就緒"
- [ ] Cell 左側有執行計數數字 `[1]`, `[2]`, `[3]`...
- [ ] 沒有看到 `[*]`（表示卡住）
- [ ] 輸出區域沒有被摺疊
- [ ] Mosquitto Broker 正在運行

---

## 💡 總結

**Notebook 代碼本身沒有問題！** 如果沒有輸出，99% 是以下原因：

1. **沒有按順序執行** ← 最常見
2. **Kernel 沒有重啟** ← 第二常見
3. **Cell 4 被重複執行** ← 第三常見
4. **Cell 還在執行中**（顯示 `[*]`）
5. **輸出被隱藏或摺疊**

**最簡單的解決方法：**
1. 重啟 Kernel
2. 從頭按順序執行
3. 或直接使用命令列腳本！

---

**如果還是有問題，請提供：**
1. Cell 左側顯示什麼？（`[ ]`, `[1]`, `[*]`？）
2. 右上角 Kernel 狀態？（"Idle", "Busy", "No Kernel"？）
3. 有沒有看到任何錯誤訊息？
4. `test_notebook_cells.py` 能正常執行嗎？





