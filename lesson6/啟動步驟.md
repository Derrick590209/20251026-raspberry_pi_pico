# Flask MQTT 監控應用程式啟動步驟

## 🚀 快速啟動

### 步驟 1：開啟終端並啟動應用程式

```bash
cd /home/pi/Documents/GiHub/20251026-raspberry_pi_pico/lesson6
source /home/pi/Documents/GiHub/20251026-raspberry_pi_pico/.venv/bin/activate
python app_flask.py
```

### 步驟 2：確認應用程式已啟動

您應該看到類似以下的輸出：

```
📂 載入歷史數據...
✅ 已載入 XX 筆歷史數據
============================================================
 Flask MQTT 監控應用程式
============================================================
 啟動中...
 MQTT Broker: localhost:1883
 MQTT Topic: 客廳/感測器
 CSV 檔案: sensor_data.csv
============================================================
 * Serving Flask app 'app_flask'
 * Debug mode: off
✅ MQTT 連線成功
✅ 已訂閱主題: 客廳/感測器
WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:8080
 * Running on http://192.168.1.16:8080
Press CTRL+C to quit
```

### 步驟 3：在瀏覽器中開啟

打開瀏覽器，訪問以下任一網址：

- **http://127.0.0.1:8080**
- **http://localhost:8080**
- **http://192.168.1.16:8080** (從其他裝置訪問)

### 步驟 4：發送測試數據（可選）

**重要：保持步驟 1 的終端視窗開啟！**

開啟**另一個新的終端視窗**，執行：

```bash
cd /home/pi/Documents/GiHub/20251026-raspberry_pi_pico/lesson6
source /home/pi/Documents/GiHub/20251026-raspberry_pi_pico/.venv/bin/activate
python test_mqtt_publish.py
```

## 📊 預期效果

發送測試數據後：

1. **終端 1（app_flask.py）** 會顯示：
   ```
   📨 收到訊息: {"temperature": 25.3, "humidity": 62.5, ...}
   ```

2. **瀏覽器** 會即時更新：
   - 💡 電燈狀態會閃爍（開/關）
   - 🌡️ 溫度數值會變化
   - 💧 濕度數值會變化
   - 📈 圖表會增加新的數據點
   - 最後更新時間會顯示當前時間

## ❓ 常見問題

### Q1: 瀏覽器顯示「無法連線」或「拒絕連線」

**原因：** 應用程式沒有在運行

**解決方法：**
1. 檢查終端是否顯示 `Running on http://127.0.0.1:8080`
2. 如果沒有，重新執行步驟 1
3. 確保終端視窗保持開啟

### Q2: 如何確認應用程式是否在運行？

在終端執行：
```bash
ps aux | grep app_flask.py
```

如果有輸出，表示應用程式正在運行。

### Q3: 如何停止應用程式？

在運行 `app_flask.py` 的終端中按 `Ctrl+C`

### Q4: 端口 8080 被佔用

檢查是否有其他程式使用 8080 端口：
```bash
lsof -i :8080
```

停止佔用的程式或修改 `app_flask.py` 中的端口號。

### Q5: MQTT 測試數據發送成功，但瀏覽器沒有更新

**檢查清單：**
1. ✅ 應用程式是否在運行？
2. ✅ 瀏覽器是否已開啟網頁？
3. ✅ 查看應用程式終端是否顯示「📨 收到訊息」
4. ✅ 檢查 MQTT 主題是否匹配（都是「客廳/感測器」）

## 🔧 除錯技巧

### 檢查應用程式狀態
```bash
# 檢查進程
ps aux | grep app_flask

# 檢查端口
lsof -i :8080

# 檢查 MQTT broker
systemctl status mosquitto
```

### 查看日誌
應用程式的所有輸出都會顯示在終端中，注意觀察是否有錯誤訊息。

## 📝 注意事項

1. **保持終端開啟**：應用程式在前台運行，關閉終端會停止應用程式
2. **虛擬環境**：確保已激活虛擬環境（提示符前有 `(pi-pico)`）
3. **MQTT Broker**：確保 mosquitto 服務正在運行
4. **網路**：確保沒有防火牆阻擋 8080 端口

## 🎯 完整測試流程

1. 開啟終端 1 → 啟動 `app_flask.py` → 看到 "Running on http://127.0.0.1:8080"
2. 開啟瀏覽器 → 訪問 http://127.0.0.1:8080 → 看到儀表板
3. 開啟終端 2 → 執行 `test_mqtt_publish.py` → 看到發送成功
4. 觀察終端 1 → 應顯示「📨 收到訊息」
5. 觀察瀏覽器 → 數據即時更新

祝使用愉快！🎉

