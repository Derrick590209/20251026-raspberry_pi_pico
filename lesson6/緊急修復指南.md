# ğŸš¨ MQTT æ–·ç·šå•é¡Œ - ç·Šæ€¥ä¿®å¾©æŒ‡å—

## å•é¡Œç—‡ç‹€
```
âœ… æˆåŠŸé€£æ¥åˆ° MQTT Broker
âš ï¸ æ„å¤–æ–·ç·šï¼ŒéŒ¯èª¤ç¢¼: Unspecified error
```

---

## âš¡ ç«‹å³è§£æ±ºæ–¹æ³•ï¼ˆ3 æ­¥é©Ÿï¼‰

### æ­¥é©Ÿ 1ï¼šåœæ­¢ä½¿ç”¨ Jupyter Notebookï¼ˆæš«æ™‚ï¼‰

**åŸå› ï¼š** Jupyter Notebook ä¸­æœ‰å¤šå€‹èˆŠé€£ç·šåœ¨èƒŒæ™¯é‹è¡Œï¼Œå°è‡´ CLIENT_ID è¡çªã€‚

### æ­¥é©Ÿ 2ï¼šä½¿ç”¨å‘½ä»¤åˆ—è…³æœ¬æ¸¬è©¦ï¼ˆ100% å¯é ï¼‰

æ‰“é–‹**å…©å€‹çµ‚ç«¯æ©Ÿ**ï¼š

**çµ‚ç«¯æ©Ÿ 1ï¼ˆè¨‚é–±è€…ï¼‰ï¼š**
```bash
cd /home/pi/Documents/GiHub/20251026-raspberry_pi_pico
uv run python lesson6/mqtt_subscribe_test.py
```

ä¿æŒé‹è¡Œï¼Œç­‰å¾…æ¥æ”¶è¨Šæ¯ã€‚

**çµ‚ç«¯æ©Ÿ 2ï¼ˆç™¼å¸ƒè€…ï¼‰ï¼š**
```bash
cd /home/pi/Documents/GiHub/20251026-raspberry_pi_pico
uv run python lesson6/mqtt_test_simple.py
```

### æ­¥é©Ÿ 3ï¼šç¢ºèªæ¸¬è©¦æˆåŠŸ

åœ¨çµ‚ç«¯æ©Ÿ 1 æ‡‰è©²æœƒçœ‹åˆ°ï¼š
```
============================================================
ğŸ“© è¨Šæ¯ #1 - 23:45:12
============================================================
ğŸŒ¡ï¸  æº«åº¦: 24.33Â°C
ğŸ’§ æ¿•åº¦: 48.03%
ğŸ’¡ é›»ç‡ˆ: é–‹
ğŸ“± è£ç½®: æ¸¬è©¦è£ç½®
```

**æ²’æœ‰ä»»ä½•æ–·ç·šéŒ¯èª¤ï¼** âœ…

---

## ğŸ”§ å¦‚æœé‚„æ˜¯è¦ç”¨ Jupyter Notebook

### æ–¹æ³• Aï¼šå®Œå…¨é‡å•Ÿï¼ˆæ¨è–¦ï¼‰

1. **é—œé–‰æ‰€æœ‰ Jupyter Notebook åˆ†é **
2. **åœ¨çµ‚ç«¯æ©Ÿä¸­åœæ­¢ Jupyterï¼š**
   ```bash
   # æ‰¾åˆ° Jupyter é€²ç¨‹
   ps aux | grep jupyter
   
   # åœæ­¢ Jupyterï¼ˆCtrl+C åœ¨é‹è¡Œ Jupyter çš„çµ‚ç«¯æ©Ÿï¼‰
   ```

3. **é‡å•Ÿ Mosquittoï¼š**
   ```bash
   sudo systemctl restart mosquitto
   ```

4. **é‡æ–°å•Ÿå‹• Jupyterï¼š**
   ```bash
   cd /home/pi/Documents/GiHub/20251026-raspberry_pi_pico
   uv run jupyter notebook
   ```

5. **æŒ‰æ­£ç¢ºé †åºåŸ·è¡Œï¼š**
   - åªé–‹å•Ÿä¸€å€‹ Notebook
   - é‡å•Ÿ Kernelï¼ˆKernel â†’ Restart Kernelï¼‰
   - ä¾åºåŸ·è¡Œ Cell 1 â†’ 2 â†’ 3 â†’ 4
   - **ä¸è¦é‡è¤‡åŸ·è¡Œ Cell 4ï¼**

### æ–¹æ³• Bï¼šä¿®æ”¹ Notebookï¼ˆæ²»æœ¬ï¼‰

åœ¨ Cell 4 ä¹‹å‰æ·»åŠ ä¸€å€‹æ–°çš„ cellï¼š

```python
# å¼·åˆ¶æ¸…ç†æ‰€æœ‰èˆŠé€£ç·š
import subprocess
import time

print("ğŸ§¹ æ¸…ç†æ‰€æœ‰èˆŠé€£ç·š...")

# æ–¹æ³• 1ï¼šæ–·é–‹æ‰€æœ‰èˆŠçš„ MQTT å®¢æˆ¶ç«¯
try:
    if 'client' in globals():
        try:
            client.loop_stop()
            client.disconnect()
        except:
            pass
        del client
        print("âœ… èˆŠå®¢æˆ¶ç«¯å·²æ¸…ç†")
except:
    pass

# æ–¹æ³• 2ï¼šé‡å•Ÿ Mosquittoï¼ˆéœ€è¦ sudo æ¬Šé™ï¼‰
# subprocess.run(['sudo', 'systemctl', 'restart', 'mosquitto'])
# time.sleep(2)

print("âœ… æ¸…ç†å®Œæˆï¼Œå¯ä»¥ç¹¼çºŒé€£ç·š")
time.sleep(1)
```

ç„¶å¾Œå†åŸ·è¡Œé€£ç·š cellã€‚

---

## ğŸ¯ æ ¹æœ¬åŸå› 

### ç‚ºä»€éº¼æœƒä¸€ç›´æ–·ç·šï¼Ÿ

1. **é‡è¤‡åŸ·è¡Œé€£ç·š cell** â†’ å‰µå»ºå¤šå€‹é€£ç·š
2. **CLIENT_ID é‡è¤‡** â†’ Broker è¸¢æ‰èˆŠé€£ç·š
3. **èˆŠé€£ç·šä»åœ¨èƒŒæ™¯é‹è¡Œ** â†’ æŒçºŒé‡é€£
4. **å½¢æˆæƒ¡æ€§å¾ªç’°** â†’ ä¸æ–·é€£ç·šå’Œæ–·ç·š

### ç‚ºä»€éº¼å‘½ä»¤åˆ—è…³æœ¬ä¸æœƒæœ‰å•é¡Œï¼Ÿ

- âœ… æ¯æ¬¡åŸ·è¡Œéƒ½æ˜¯æ–°çš„é€²ç¨‹
- âœ… çµæŸå¾Œé€²ç¨‹å®Œå…¨çµ‚æ­¢
- âœ… ä¸æœƒæœ‰èˆŠé€£ç·šæ®˜ç•™
- âœ… CLIENT_ID æ¯æ¬¡éƒ½ä¸åŒ

---

## ğŸ“Š è¨ºæ–·å·¥å…·

### æŸ¥çœ‹ç•¶å‰ MQTT é€£ç·š

```bash
# æŸ¥çœ‹ Mosquitto æ—¥èªŒ
sudo tail -f /var/log/mosquitto/mosquitto.log

# æŸ¥çœ‹æ­£åœ¨é‹è¡Œçš„ Python é€²ç¨‹
ps aux | grep python | grep mqtt

# æŸ¥çœ‹ Jupyter kernels
ps aux | grep ipykernel
```

### æ¸¬è©¦ Broker æ˜¯å¦æ­£å¸¸

```bash
# æ¸¬è©¦è¨‚é–±
mosquitto_sub -h localhost -t "test" -v &

# æ¸¬è©¦ç™¼å¸ƒ
mosquitto_pub -h localhost -t "test" -m "hello"

# æ‡‰è©²æœƒçœ‹åˆ° "test hello"
```

---

## âœ… æ¨è–¦çš„æ¸¬è©¦å·¥ä½œæµç¨‹

### å·¥ä½œæµç¨‹ 1ï¼šç´”å‘½ä»¤åˆ—ï¼ˆæœ€å¯é ï¼‰

```bash
# ä½¿ç”¨ä¸€éµæ¸¬è©¦è…³æœ¬
cd /home/pi/Documents/GiHub/20251026-raspberry_pi_pico
./lesson6/test_mqtt.sh
# é¸æ“‡ 3) åŒæ™‚é‹è¡Œç™¼å¸ƒè€…å’Œè¨‚é–±è€…
```

### å·¥ä½œæµç¨‹ 2ï¼šä½¿ç”¨ Mosquitto å·¥å…·

```bash
# çµ‚ç«¯æ©Ÿ 1
mosquitto_sub -h localhost -t "å®¢å»³/æ„Ÿæ¸¬å™¨" -v

# çµ‚ç«¯æ©Ÿ 2
mosquitto_pub -h localhost -t "å®¢å»³/æ„Ÿæ¸¬å™¨" -m '{"temperature": 25, "humidity": 60}'
```

### å·¥ä½œæµç¨‹ 3ï¼šPython è…³æœ¬

```bash
# çµ‚ç«¯æ©Ÿ 1
uv run python lesson6/mqtt_subscribe_test.py

# çµ‚ç«¯æ©Ÿ 2  
uv run python lesson6/mqtt_test_simple.py
```

### å·¥ä½œæµç¨‹ 4ï¼šJupyter Notebookï¼ˆæœ€å¾Œé¸æ“‡ï¼‰

åªæœ‰åœ¨å‰ä¸‰ç¨®æ–¹æ³•éƒ½æ¸¬è©¦æˆåŠŸå¾Œï¼Œå†ä½¿ç”¨ Notebookã€‚

**ä½¿ç”¨è¦å‰‡ï¼š**
1. æ¯æ¬¡æ¸¬è©¦å‰é‡å•Ÿ Kernel
2. åªåŸ·è¡Œä¸€æ¬¡é€£ç·š cell
3. å‡ºå•é¡Œç«‹å³åœæ­¢ï¼Œä¸è¦é‡è©¦
4. æ”¹ç”¨å‘½ä»¤åˆ—æ¸¬è©¦

---

## ğŸ†˜ ç·Šæ€¥æ•‘æ´å‘½ä»¤

```bash
# 1. é‡å•Ÿæ‰€æœ‰ç›¸é—œæœå‹™
sudo systemctl restart mosquitto

# 2. åœæ­¢æ‰€æœ‰ Python MQTT é€²ç¨‹
pkill -f "python.*mqtt"

# 3. æ¸…é™¤ Mosquitto æŒä¹…åŒ–æ•¸æ“šï¼ˆå¯é¸ï¼Œæœƒæ¸…é™¤æ‰€æœ‰ä¿ç•™è¨Šæ¯ï¼‰
sudo systemctl stop mosquitto
sudo rm -rf /var/lib/mosquitto/*
sudo systemctl start mosquitto

# 4. æŸ¥çœ‹ç³»çµ±ç‹€æ…‹
systemctl status mosquitto
```

---

## ğŸ’¡ æœ€ä½³å¯¦è¸

1. **é–‹ç™¼/æ¸¬è©¦éšæ®µï¼š** ä½¿ç”¨å‘½ä»¤åˆ—è…³æœ¬
2. **æ¼”ç¤ºéšæ®µï¼š** ä½¿ç”¨ Jupyter Notebookï¼ˆå°å¿ƒæ“ä½œï¼‰
3. **ç”Ÿç”¢ç’°å¢ƒï¼š** ä½¿ç”¨ç¨ç«‹çš„ Python æœå‹™

---

## ğŸ“ å¿«é€Ÿåƒè€ƒ

### å‘½ä»¤åˆ—æ¸¬è©¦ï¼ˆæ¨è–¦ï¼‰
```bash
cd /home/pi/Documents/GiHub/20251026-raspberry_pi_pico
./lesson6/test_mqtt.sh
```

### Jupyter é‡å•Ÿ
```
Kernel â†’ Restart Kernel â†’ Restart
```

### æŸ¥çœ‹æ—¥èªŒ
```bash
sudo tail -f /var/log/mosquitto/mosquitto.log
```

---

è¨˜ä½ï¼š**ç•¶ Notebook å‡ºå•é¡Œæ™‚ï¼Œç«‹å³åˆ‡æ›åˆ°å‘½ä»¤åˆ—è…³æœ¬ï¼** ğŸš€





